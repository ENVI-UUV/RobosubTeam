
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>SimBox - Robosub Simulator</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #000;
				font-family:Monospace;
				font-size:13px;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				position: absolute;
				top: 0px; width: 100%;
				text-align:center;
				padding: 5px;
			}
			#inset  {
				width: 200px;
				height: 200px;
				background-color: #fff; /* or transparent; will show through only if renderer alpha: true */
				border: 1px solid black; /* or none; */
				margin: 20px;
				padding: 0px;
				position: absolute;
				left: 0px;
				bottom: 0px;
    				z-index: 100;
			}
			#inset2  {
				width: 200px;
				height: 200px;
				background-color: transparent; /* or transparent; will show through only if renderer alpha: true */
				border: 1px solid black; /* or none; */
				margin: 20px;
				padding: 0px;
				position: fixed;
				right: 0px;
				bottom: 0px;
    				z-index: 100;
			}
			<!--.styling{
				background-color:black;
				color:lime;
				font: bold 16px MS Sans Serif;
				padding: 3px;
				position: fixed;
				left: 0px;
				top: 0px;
				}-->
			//What is this?
			a {
				color: #000000;
			}
			//What is this?
		</style>
	</head>
	<body>

		<div id="info"><a href="https://github.com/cantren/cantren.github.io/" target="_blank">Code</a></a> - Please "fork" as this page changes often.</div>
		<div id="container">
		<div id="inset">
		<script src="../js/three.min.js"></script>
		
		<script src="../js/FirstPersonControls.js"></script>
		<script src="../js/KeyboardState.js"></script>
		<script src="../js/Mirror.js"></script>
		<script src="../js/WaterShader.js"></script>
		<script src="../js/material.js"></script>


		<script src="../js/Detector.js"></script>
		<script src="../js/stats.min.js"></script>
		
		<script src="../js/josdirksen/dat.gui.js"></script> 
		
		<script src="js/MTLLoader.js"></script>
		<script type="text/javascript" src="js/OBJMTLLoader.js"></script>


  		<div id='inset2'>
		<object width="200" height="200"><param name="movie" value="http://127.0.0.1:8090/simbox.swf">
		<embed src="http://127.0.0.1:8090/simbox.swf" width="200" height="200">
		</embed></object></div>
		
					<span id="digitalclock" class="styling"></span>

<script>
<!--

//LCD Clock script- by javascriptkit.com
//Visit JavaScript Kit (http://javascriptkit.com) for script
//Credit must stay intact for use

var alternate=0
var standardbrowser=!document.all&&!document.getElementById

if (standardbrowser)
document.write('<form name="tick"><input type="text" name="tock" size="11"></form>')

function show(){
if (!standardbrowser)
var clockobj=document.getElementById? document.getElementById("digitalclock") : document.all.digitalclock
//var Digital=new Date("July 28, 2014 11:13:00")
var RealTime=new Date()
var year=15
var month=7
var day=24
var hours=RealTime.getHours()
//var hours=Digital.getHours()
//var hoursReal=RealTime.getHours()
var minutes=RealTime.getMinutes()
//var minutes=Digital.getMinutes()
//var minutesReal=RealTime.getMinutes()
var seconds=RealTime.getSeconds()
var dn="AM"

if (hours==12) dn="PM" 
if (hours>12){
dn="PM"
//hours=hours-12
}

if (hours==0) hours=12
if (hours.toString().length==1)
hours="0"+hours
if (minutes<=9)
minutes="0"+minutes
if (seconds<=9)
seconds="0"+seconds
if (standardbrowser){
if (alternate==0)
document.tick.tock.value=hours+" : "+minutes+" "+dn
else
document.tick.tock.value=hours+"   "+minutes+" "+dn
}
else{
if (alternate==0)
clockobj.innerHTML=month+" / "+day+" / "+year+"   "+hours+" : "+minutes+" : "+seconds+" "+"<sup style='font-size:70%'>"+dn+"</sup>"
else
clockobj.innerHTML=month+" / "+day+" / "+year+"   "+hours+" : "+minutes+" : "+seconds+" "+"<sup style='font-size:70%'>"+dn+"</sup>"
}
alternate=(alternate==0)? 1 : 0
setTimeout("show()",1000)
}
window.onload=show

//-->
/*
<p>This free script provided by<br/>
<a href="http://javascriptkit.com">JavaScript
Kit</a></p>
*/
</script>


		<script>
/*
The MIT License

Copyright © 2010-2015 three.js authors

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

#Copyright Notes:
1)SimBox started as a JavaScript "learning experiment" with modifications made to code which should be attributed to the authors of the three.js examples under the MIT License "http://threejs.org/examples/webgl_shaders_ocean.html" and "http://threejs.org/examples/webgl_loader_obj_mtl.html"
2)Significant effort has been made to track, identify, and flag all "borrowed" code which was used to learn the dat.gui.js and three.js libraries
3)The most heavily "borrowed" code(that isn't from three.js examples) is actually from the work of a jsFiddle.net author(previously unattributed user, later identified as "WestLangley") who is assumed to be the same stackoverflow user who answered a question about a downward facing camera here: http://stackoverflow.com/a/16227714
4)To the knowledge of the author of this "index.html" file, all "borrowed" code has since been mutilated/revised/changed/modified/or adapted to nullify any remaining claims to the work with the exception of the code produced by WestLangley and those works which are protected under the MIT License described above.
*/
			//source: MIT License OR "This code no longer appears to contain anything that belongs to josdirksen?"
			if ( ! Detector.webgl ) {
				Detector.addGetWebGLMessage();
				document.getElementById( 'container' ).innerHTML = "";
			}
			//source: MIT License OR "This code no longer appears to contain anything that belongs to josdirksen?"

			var container, container2, stats;//cargo cult code? comment out this line please(may be desired in future)
			var camera, camera2, camera3, camControls, camControls2, camControls3, scene, scene2, renderer, renderer2;//these are actually usefull
			var CANVAS_WIDTH = 200,
			    CANVAS_HEIGHT = 200,
			    CAM_DISTANCE = 300;//This doesn't look like cargo cult code but should be sanity checked at some point
			var clock = new THREE.Clock();//I spent a long time debugging because I forgot to initialize this
			var keyboard = new KeyboardState();//this appears to help with keyboard input... Part of FPS controls/Key bindings?
			
//I'll admit: I can't remember what this does or where it came from
var parameters = {
				width: 2000,
				height: 2000,
				widthSegments: 250,
				heightSegments: 250,
				depth: 1500,
				param: 4,
				filterparam: 1
			}
//I'll admit: I can't remember what this does or where it came from			
			var waterNormals;
			init();
			animate();

			//source: This entire "init()" function is very "boilerplate" from the examples at http://threejs.org/examples/ covered under the MIT License
			function init() {
				container = document.createElement( 'div' );
				document.body.appendChild( container );
				
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
				
				container2 = document.getElementById('inset');
				// renderer
				renderer2 = new THREE.WebGLRenderer();
				renderer2.setClearColor( 0xf0f0f0, 1 );
				renderer2.setSize( CANVAS_WIDTH, CANVAS_HEIGHT );
				container2.appendChild( renderer2.domElement );


				scene = new THREE.Scene();
				scene2 = new THREE.Scene();
				
				//add water colored fog
				scene.fog = new THREE.FogExp2( 0x008080, 0.1875 );
				scene2.fog = new THREE.FogExp2( 0x008080, 0.1875 );
				
				camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.5, 3000000);
				
				camera.position.x = 0.0;//pool line of symetry is x axis
				camera.position.y = -2.0;//water depth
			        camera.position.z = -28.0;//how close to the wall are you
			        camera.rotation.z = 3.06;
			        
			        camera2 = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.5, 3000000);
			        camera2.up = camera.up; // important!
			        
			        camera2.position.x = 0.0;//pool line of symetry is x axis
				camera2.position.y = -2.0;//water depth
			        camera2.position.z = -28.0;//how close to the wall are you
			        camera2.rotation.z = 3.06;
				//camera.position.set( 0, -2, -28 );
				
				camera3 = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.5, 3000000);
			        camera3.up = camera.up; // important!
			        
				camera3.position.x = 0.0;//pool line of symetry is x axis
				camera3.position.y = -2.0;//water depth
			        camera3.position.z = -28.0;//how close to the wall are you

				
				camControls = new THREE.FirstPersonControls( camera, renderer.domElement );
				camControls.lookSpeed = 0.05; //Pitch Thrust to drag ratio
				camControls.movementSpeed = 0.25; // FWD BKWD Thrust to drag ratio 
				camControls.verticalMin = -50.0; //basement floor level
				camControls.verticalMax = 10.0; //sky ceiling level
				
				camControls2 = new THREE.FirstPersonControls( camera2, renderer2.domElement );
				camControls2.lookSpeed = 0.05; //Pitch Thrust to drag ratio
				camControls2.movementSpeed = 0.25; // FWD BKWD Thrust to drag ratio 
				camControls2.verticalMin = -50.0; //basement floor level
				camControls2.verticalMax = 10.0; //sky ceiling level
				
				camControls3 = new THREE.FirstPersonControls( camera2, renderer2.domElement );
				camControls2.lookSpeed = 0.05; //Pitch Thrust to drag ratio
				camControls2.movementSpeed = 0.25; // FWD BKWD Thrust to drag ratio 
				camControls2.verticalMin = -50.0; //basement floor level
				camControls2.verticalMax = 10.0; //sky ceiling level
				
				
				
				//Add scene lighting
				var light = new THREE.HemisphereLight( 0xffffbb, 0x008080, 1 );//I tried changing the light color here to see what would happen
				light.position.set( - 1, 1, - 1 ); //my hemisphere flipped upside down
				light.intensity = .125;
				//scene.add( light );//I changed the name to distinguish a negative y value from "sunlight"

				var light2 = new THREE.HemisphereLight( 0xffffbb, 0x008080, 1 );//I tried changing the light color here to see what would happen
				light2.position.set( - 1, 1, - 1 ); //my hemisphere flipped upside down
				light2.intensity = .125;
				//scene2.add( light2 );//I changed the name to distinguish a negative y value from "sunlight"
				/*
				//var directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
				//directionalLight.position.set( 0, -1, 0 );
				//scene.add( directionalLight );
				
				//var directionalLight2 = new THREE.DirectionalLight( 0xffffff, 1 );
				//directionalLight2.position.set( 0, 1, 0 );
				//scene.add( directionalLight2 );
				*/
				//More scene lighting
				var ambientLight = new THREE.AmbientLight(0xffffff);
				ambientLight.intensity = .25;
				//scene.add(ambientLight);
				
				var ambientLight2 = new THREE.AmbientLight(0xffffff);
				ambientLight2.intensity = .25;
				//scene2.add(ambientLight2);
				
				//light up the sun
				//spotLightSUN = new THREE.SpotLight(0xFFFFFF);
				//spotLightSUN.position.set(100, 140, -130);
				//spotLightSUN.intensity = 1000;
				//scene.add(spotLightSUN);
				
				
				//Add the three spotlights representing the sun(intensity will be modified as a function of depth)
				spotLightRED = new THREE.SpotLight(0xff0000);
				spotLightRED.position.set(100, 140, -130);
				spotLightRED.intensity = .75;
				scene.add(spotLightRED);
				
				spotLightRED2 = new THREE.SpotLight(0xff0000);
				spotLightRED2.position.set(100, 140, -130);
				spotLightRED2.intensity = .75;
				scene2.add(spotLightRED2);
				
				spotLightBLUE = new THREE.SpotLight(0x00a9ff);
				spotLightBLUE.position.set(100, 140, -130);
				spotLightBLUE.intensity = .75;
				scene.add(spotLightBLUE);
				
				spotLightBLUE2 = new THREE.SpotLight(0x00a9ff);
				spotLightBLUE2.position.set(100, 140, -130);
				spotLightBLUE2.intensity = .75;
				scene2.add(spotLightBLUE2);
				
				spotLightGREEN = new THREE.SpotLight(0x5eff00);
				spotLightGREEN.position.set(100, 140, -130);
				spotLightGREEN.intensity = .75;
				scene.add(spotLightGREEN);
				
				spotLightGREEN2 = new THREE.SpotLight(0x5eff00);
				spotLightGREEN2.position.set(100, 140, -130);
				spotLightGREEN2.intensity = .75;
				scene2.add(spotLightGREEN2);
				//Add the three spotlights representing the sun(intensity will be modified as a function of depth)


				
				// add spotlight for the shadows
				/*
				var spotLight = new THREE.SpotLight(0xffffff);
				spotLight.position.set(100, 140, 130);
				spotLight.intensity = 2;
				scene.add(spotLight);
				
				var spotLight2 = new THREE.SpotLight(0xffffff);
				spotLight2.position.set(100, 140, 130);
				spotLight2.intensity = 2;
				scene2.add(spotLight2);
				*/


				//load and insert the obj meshes and mtl textures
				//the "secret sauce" is in these .obj and .mtl files.
				var loader = new THREE.OBJMTLLoader(); //this object does the work
				loader.load('../obj/transdec OBJ/transdec test.obj', '../obj/transdec OBJ/transdec test.mtl', function ( object ) {
					object.position.y = -12.975;//experimentally generated via trial and error
					scene.add( object );//to make a Robosub you would likely need to change it's name from "object"
					});
				loader.load('../obj/robosub obstacles/obstacles.obj', '../obj/robosub obstacles/obstacles.mtl', function ( object ) {
					object.position.y = -12.975;//experimentally generated via trial and error
					for(var i in object.children) {
					        object.children[i].material = new THREE.MeshDepthMaterial();
					} // end apply to Mesh of interest
					scene.add( object );//to make a Robosub you would likely need to change it's name from "object"
					});
				loader.load('../obj/transdec OBJ/transdec test.obj', '../obj/transdec OBJ/transdec test.mtl', function ( object ) {
					object.position.y = -12.975;//experimentally generated via trial and error
					scene2.add( object );//to make a Robosub you would likely need to change it's name from "object"
					});
				loader.load('../obj/robosub obstacles/obstacles.obj', '../obj/robosub obstacles/obstacles.mtl', function ( object ) {
					object.position.y = -12.975;//experimentally generated via trial and error
					scene2.add( object );//to make a Robosub you would likely need to change it's name from "object"
					});

				waterNormals = new THREE.ImageUtils.loadTexture( 'textures/waternormals.jpg' ); //potential for easy modification/obstacle reflections
				waterNormals.wrapS = waterNormals.wrapT = THREE.RepeatWrapping; //recycle that .jpg like a TV re-run
				//initialize/declare water shader and provide parameters
				water = new THREE.Water( renderer, camera, scene, {
					textureWidth: 64, 
					textureHeight: 64,
					waterNormals: waterNormals,
					alpha: 	0.925,
					sunDirection: spotLightRED.position.clone().normalize(),
					sunColor: 0xffffff,
					waterColor: 0x001e0f,
					distortionScale: 6.25,
					fog: true,
				} );
				/*
				water = new THREE.Water( renderer, camera, scene, { //three.js has a specific thing for water, this is it
					textureWidth: 512, //size of waves I think, maybe the waternormals.jpg stretch?
					textureHeight: 512, //size of waves I think, maybe the waternormals.jpg stretch?
					waterNormals: waterNormals, //provides the .jpg Texture
					alpha: 	0.925, //how transparent is the water?
					//sunDirection: new THREE.Vector3( 0.70707, -0.70707, 0 ), 
					sunDirection: light.position.clone().normalize(), // I think this makes the reflection normal to the texture
					sunColor: 0xffffff, //Light has to hit the water, what color is it?
					waterColor: 0xe7e7ec,//,0x000000,//0x001e0f,//0xe7e7ec,//0x001e0f,//water color for different effects
					distortionScale: 50.0, //also related to size of waves?
					fog: true,
				});
				*/

				//initialize/declare new planes for holding the "water" texture mapping
				mirrorMesh = new THREE.Mesh(
					new THREE.PlaneBufferGeometry( parameters.width * 500, parameters.height * 500 ),
					water.material
				);
				mirrorMesh2 = new THREE.Mesh(
					new THREE.PlaneBufferGeometry( parameters.width * 500, parameters.height * 500 ),
					water.material
				);
			
				mirrorMesh.add( water ); //add water shader to otherwise boring underwater PlaneBufferGeometry
				mirrorMesh2.add( water ); //add water shader to otherwise boring PlaneBufferGeometry
				mirrorMesh.rotation.x = - Math.PI * 1.5; //rotate undwater water surface to point down
				mirrorMesh2.rotation.x = - Math.PI * 0.5; //rotate water surface to point up
				mirrorMesh.position.y = -.95;//water height experimentally generated via trial and error
				mirrorMesh2.position.y = -.95;//water height experimentally generated via trial and error
				
				scene.add( mirrorMesh ); //add underwater water surface
				scene.add( mirrorMesh2); //add water surface
				
				// load skybox &/or (start example code copypasta: http://threejs.org/examples/#webgl_shaders_ocean)
				var cubeMap = new THREE.CubeTexture( [] );//initialize/declare the texture object to be mapped to the skybox mesh var skyBox = new THREE.Mesh
				cubeMap.format = THREE.RGBFormat;//don't know what this does, appears to be a type declaration?
				cubeMap.flipY = false;//if you make this true the walls of the box go below the horizon

				
				var loader = new THREE.ImageLoader();
				loader.load( '../textures/skyboxsun25degtest.png', function ( image ) {
					var getSide = function ( x, y ) {
						var size = 1024;
						var canvas = document.createElement( 'canvas' );
						canvas.width = size;
						canvas.height = size;
						var context = canvas.getContext( '2d' );
						context.drawImage( image, - x * size, - y * size );
						return canvas;
					};
					cubeMap.images[ 0 ] = getSide( 2, 1 ); // px
					cubeMap.images[ 1 ] = getSide( 0, 1 ); // nx
					cubeMap.images[ 2 ] = getSide( 1, 0 ); // py
					cubeMap.images[ 3 ] = getSide( 1, 2 ); // ny
					cubeMap.images[ 4 ] = getSide( 1, 1 ); // pz
					cubeMap.images[ 5 ] = getSide( 3, 1 ); // nz
					cubeMap.needsUpdate = true;
				} );

				var cubeShader = THREE.ShaderLib['cube'];
				cubeShader.uniforms['tCube'].value = cubeMap;

				//Create skybox material 
				var skyBoxMaterial = new THREE.ShaderMaterial( {
					fragmentShader: cubeShader.fragmentShader,
					vertexShader: cubeShader.vertexShader,
					uniforms: cubeShader.uniforms,
					depthWrite: false,
					//fog: true, //To Do: make a derived shade which has been modified for "fog"
					side: THREE.BackSide
				});
				
				//Create Mesh to map skybox material on to
				var skyBox = new THREE.Mesh(
					new THREE.BoxGeometry( 10000, 10000, 10000 ),
					skyBoxMaterial
				);
				scene.add( skyBox ); //create Point Loma Sky
				
				var geometry = new THREE.IcosahedronGeometry( 30, 4 );
				for ( var i = 0, j = geometry.faces.length; i < j; i ++ ) {
					geometry.faces[ i ].color.setHex( 0xffffff );
				}
				var material = new THREE.MeshPhongMaterial( {
					vertexColors: THREE.FaceColors,
					shininess: 100000,
					envMap: cubeMap
				} );
				sphere = new THREE.Mesh( geometry, material );
				scene.add( sphere );
				
				var geometry2 = new THREE.IcosahedronGeometry( 10, 4 );
				for ( var i = 0, j = geometry.faces.length; i < j; i ++ ) {
					geometry.faces[ i ].color.setHex( 0xffff00 );
				}
				var material2 = new THREE.MeshPhongMaterial( {
					vertexColors: THREE.FaceColors,
					shininess: 100,
					envMap: cubeMap
				} );
				sphere2 = new THREE.Mesh( geometry2, material2 );
				//scene.add( sphere2 );
				
			}
			//source: This entire "init()" function is very "boilerplate" from the examples at http://threejs.org/examples/ covered under the MIT License
			//attribution: Please see the "MIT License" included in this document

			//source: This code no longer appears to contain anything that belongs to http://www.smartjava.org/ltjs/chapter-09/02-selecting-objects.html
			var guivalues = new function () {
					
				    this.timeShift = 0;
				    this.getLostBoth = function(){
				    	camera.position.x = (Math.random() * 90.0);
				    	camera.position.x -=45.0;
				    	camera.position.y = ((Math.random() * -4.55) - 0.95);
				    	camera.position.z = (Math.random() * 60.0);
				    	camera.position.z -= 30.0;
       				    	camera.rotation.z = (Math.random() * (Math.PI*2.0));
       				    	camera.rotation.z -= Math.PI;
				    };
				    this.getLostComp = function(){
				    	camera.position.x = (Math.random() * -45.0);
				    	camera.position.y = ((Math.random() * -4.55) - 0.95);
				    	camera.position.z = (Math.random() * 60.0);
				    	camera.position.z -= 30.0;
       				    	camera.rotation.z = (Math.random() * (Math.PI*2.0));
       				    	camera.rotation.z -= Math.PI;
				    };
				    this.getLostPract = function(){
				    	camera.position.x = (Math.random() * 45.0);
				    	camera.position.y = ((Math.random() * -4.55) - 0.95);
				    	camera.position.z = (Math.random() * 60.0);
				    	camera.position.z -= 30.0;

       				    	camera.rotation.z = (Math.random() * (Math.PI*2.0));
       				    	camera.rotation.z -= Math.PI;
				    };
				    this.lookAtRedBuoy = function(){
				    	camera.position.x = -23.14 + ((Math.random() * 10.0) - 5.0);
				    	camera.position.y = -2.2;// + ((Math.random() * 1.0) - 0.5);
				    	camera.position.z = -21.74 + ((Math.random() * 10.0) - 5.0);
				    	//camera3.position.copy(camera);
				    	camera3.position.x =-23.14;
				    	camera3.position.y = -2.2
				    	camera3.position.z = -21.74;
				    	
				    	
				    	//camera.lookAt(-23.14,-2.2,-21.74);
				    	//camera2.lookAt(camera3);
				    	//camera.rotation.z = camera3.rotation.z;

       				    	//camera.rotation.z = (Math.random() * (Math.PI*2.0));
       				    	//camera.rotation.z -= Math.PI;
				    };
				    this.lookAtYellowBuoy = function(){
				    	camera.position.x = -22.44 + ((Math.random() * 10.0) - 5.0);
				    	camera.position.y = -2.15;// + ((Math.random() * 1.0) - 0.5);
				    	camera.position.z = -20.69 + ((Math.random() * 10.0) - 5.0);
				    	//camera3.position.copy(camera);
				    	//camera.lookAt(-22.44,-2.15,-20.69);
				    	//camera.rotation.z = camera3.rotation.z;

       				    	//camera.rotation.z = (Math.random() * (Math.PI*2.0));
       				    	//camera.rotation.z -= Math.PI;
				    };
				    this.lookAtGreenBuoy = function(){
				    	camera.position.x = -21.8 + ((Math.random() * 10.0) - 5.0);
				    	camera.position.y = -2.05;// + ((Math.random() * 1.0) - 0.5);
				    	camera.position.z = -19.65 + ((Math.random() * 10.0) - 5.0);
				    	//camera3.position.copy(camera);
				    	//camera.lookAt(-21.8,-2.05,-19.65);
				    	//camera.rotation.z = camera3.rotation.z;

       				    	//camera.rotation.z = (Math.random() * (Math.PI*2.0));
       				    	//camera.rotation.z -= Math.PI;
				    };


				    this.lightDepthFix = function(){
					intensity = .85;
					depthcm = (camera2.position.y + (0.9)) * (-100.0);
					adjIntensityRED = (intensity * (Math.exp(-.006 * depthcm)));
					adjIntensityGREEN = (intensity * (Math.exp(-.00032 * depthcm)));
					adjIntensityBLUE = (intensity * (Math.exp(-.000247 * depthcm)));
					spotLightRED.intensity = adjIntensityRED;
					spotLightRED2.intensity = adjIntensityRED;
					spotLightGREEN.intensity = adjIntensityGREEN;
					spotLightGREEN2.intensity = adjIntensityGREEN;
					spotLightBLUE.intensity = adjIntensityBLUE;
					spotLightBLUE2.intensity = adjIntensityBLUE;
				    };
				    this.normalLight = function(){
					var nintensity = 0.85;
					spotLightRED.intensity = nintensity;
					spotLightRED2.intensity = nintensity;
					spotLightGREEN.intensity = nintensity;
					spotLightGREEN2.intensity = nintensity;
					spotLightBLUE.intensity = nintensity;
					spotLightBLUE2.intensity = nintensity;
				    	//scene.spotLight.intensity = (Math.random() * 5.0);
				    	//scene2.spotLight2.intensity = (Math.random() * 5.0);
				    };
				    this.randomVis = function(){
				    	fdensity = (Math.random() * .75);
					scene.fog.density = fdensity;
					scene2.fog.density = fdensity;
				    	
					rintensity = (Math.random() * 0.6667);
					
					spotLightRED.intensity = rintensity;
					spotLightRED2.intensity = rintensity;
					spotLightGREEN.intensity = rintensity;
					spotLightGREEN2.intensity = rintensity;
					spotLightBLUE.intensity = rintensity;
					spotLightBLUE2.intensity = rintensity;

				    };
				}
			//source: This code no longer appears to contain anything that belongs to http://www.smartjava.org/ltjs/chapter-09/02-selecting-objects.html

				
			//source: This code no longer appears to contain anything that belongs to http://nuevil.com/index3.html
			var gui = new dat.GUI({resizable : false});
			var folder1 = gui.addFolder('visibility');
			var fogDensity = folder1.add(scene2.fog, 'density').min(0.00).max(0.75).step(0.01).listen();
			var lightIntensity = folder1.add(spotLightRED, 'intensity').min(0.00).max(2.0).step(0.01).listen();
			var timeOfDay = folder1.add(guivalues, 'timeShift').min(-6.0).max(6.0).step(0.01).listen();
			var folder2 = gui.addFolder('behavior');
			var rotSpeed = folder2.add(camControls2, 'lookSpeed').min(0.0).max(0.5).step(0.01).listen();
			var movSpeed = folder2.add(camControls2, 'movementSpeed').min(0.0).max(5.0).step(0.01).listen();
			var folder3 = gui.addFolder('position');
  			var posX = folder3.add( camera2.position, 'x' ).min(-50.00).max(50.00).step(0.01).listen();
  			var posY = folder3.add( camera2.position, 'y' ).min(-50.00).max(50.00).step(0.01).listen();
  			var posZ = folder3.add( camera2.position, 'z' ).min(-50.00).max(50.00).step(0.01).listen();
  			var folder4 = gui.addFolder('rotation');
  			var rotZ = folder4.add( camera.rotation, 'z' ).min(-5.00).max(5.00).step(0.01).listen();
  			var folder5 = gui.addFolder('confusion');
  			var rVis = gui.add(guivalues, 'randomVis');
  			var rPosHead = gui.add(guivalues, 'getLostBoth');
  			var rPosHeadComp = gui.add(guivalues, 'getLostComp');
  			var rPosHeadPract = gui.add(guivalues, 'getLostPract');
  			//source: This code no longer appears to contain anything that belongs to http://nuevil.com/index3.html

  			posX.onChange( function(value){   camera2.position.x = value; camera.position.x = value;   } );
  			posY.onChange( function(value){   camera2.position.y = value; camera.position.y = value;   } );
			posZ.onChange( function(value){   camera2.position.z = value; camera.position.z = value;   } );
			rotZ.onChange( function(value){   camera.rotation.z = value; camera.rotation.z = value;   } );
			//source:http://nuevil.com/index3.html

			//source: This code no longer appears to contain anything that belongs to Rudie Dirkx http://hotblocks.nl/tests/three/dat.gui.html 
			fogDensity.onChange( function(value){   scene2.fog.density = value; scene.fog.density = value;   });
  			rotSpeed.onChange( function(value){   camControls2.lookSpeed = value; camControls.lookSpeed = value;   });
			movSpeed.onChange( function(value){   camControls2.movementSpeed = value; camControls.movementSpeed = value;  });
			lightIntensity.onChange( function(value){   spotLightRED2.intensity = value; spotLightRED.intensity = value;   });
			timeOfDay.onChange( function(value){   guivalues.timeShift = value; });
			//source: This code no longer appears to contain anything that belongs to Rudie Dirkx http://hotblocks.nl/tests/three/dat.gui.html 

			//source: MIT License OR "This code no longer appears to contain anything that belongs to josdirksen?"
			function animate() {
				requestAnimationFrame( animate ); //animate the frame
				render(); //render the frame
			}
			//source: MIT License OR "This code no longer appears to contain anything that belongs to josdirksen?"

			//source: MIT License OR "This code no longer appears to contain anything that belongs to josdirksen?"
			function render() {
				keyboard.update();
				camControls.update( clock.getDelta() ); //update First Person Camera
				camControls2.update( clock.getDelta() ); //update First Person Camera
				camera2.position.copy( camera.position );
				camera2.rotation.copy( camera.rotation );
				//camera2.rotation.z = camera3.rotation.z;
				camera2.up = new THREE.Vector3(-1,-1,-1);
				camera2.rotateX(Math.PI/-2);
				camera2.rotateZ((Math.PI/-2));
				camera2.rotateZ(Math.PI/2);
				
				//camera3.position.x =-23.14;
				//camera3.position.y = -2.2
				//camera3.position.z = -21.74;
				
				//camera.lookAt(camera3);
				//camera2.lookAt(camera3);
				//if (1==1){guivalues.lightDepthFix();}
				var time = performance.now() * 0.001; //Measure time for water
				var timeSolar = performance.now() * 0.000000003472 + 32470000 + 3 * 3600000; //Measure time for sun
				
				water.material.uniforms.time.value += 1.0 / 60.0; //speed of water motion(wind chop)
				water.render(); //render water surface
				
				
				//source:https://github.com/dirkk0/threejs_daynight/blob/master/index.html
				var nsin = Math.sin(timeSolar);
				var ncos = Math.cos(timeSolar);
				// set the sun
				spotLightRED.position.set( -2000*ncos, 2000*nsin, 1500*ncos+1000);
				spotLightRED.lookAt (0,0,0);
				//spotLightRED2.position.copy( spotLightRED );
				spotLightRED2.position.set( -2000*ncos, 2000*nsin, 1500*ncos+1000);
				spotLightRED2.lookAt (0,0,0);
				//spotLightGREEN.position.copy( spotLightRED );
				spotLightGREEN.position.set( -2000*ncos, 2000*nsin, 1500*ncos+1000);
				spotLightGREEN.lookAt (0,0,0);
				//spotLightGREEN2.position.copy( spotLightRED );
				spotLightGREEN2.position.set( -2000*ncos, 2000*nsin, 1500*ncos+1000);
				spotLightGREEN2.lookAt (0,0,0);
				//spotLightBLUE.position.copy( spotLightRED );
				spotLightBLUE.position.set( -2000*ncos, 2000*nsin, 1500*ncos+1000);
				spotLightBLUE.lookAt (0,0,0);
				//spotLightBLUE2.position.copy( spotLightRED );
				spotLightBLUE2.position.set( -2000*ncos, 2000*nsin, 1500*ncos+1000);
				spotLightBLUE2.lookAt (0,0,0);
				//source:https://github.com/dirkk0/threejs_daynight/blob/master/index.html
				//spotLightSUN.position.set( -1900*ncos, 1900*nsin, 1425*ncos+1000);
				//spotLightSUN.lookAt ( spotLightRED.position );


				sphere.position.copy( spotLightRED.position );
				//sphere2.position.copy( spotLightSUN.position );

				var lightFix = new function(){
					this.lightDepthFix = function(){
					intensity = .95;
					depthcm = (camera2.position.y + (0.9)) * (-100.0);
					adjIntensityRED = (intensity * (Math.exp(-.006 * depthcm)));
					adjIntensityGREEN = (intensity * (Math.exp(-.00032 * depthcm)));
					adjIntensityBLUE = (intensity * (Math.exp(-.000247 * depthcm)));
					spotLightRED.intensity = adjIntensityRED;
					spotLightRED2.intensity = adjIntensityRED;
					spotLightGREEN.intensity = adjIntensityGREEN;
					spotLightGREEN2.intensity = adjIntensityGREEN;
					spotLightBLUE.intensity = adjIntensityBLUE;
					spotLightBLUE2.intensity = adjIntensityBLUE;
				    };
				}
				if ( keyboard.pressed("shift") ){//almost positive this is original code
					camControls2.movementSpeed = 2.0;//note: it also doesn't work properly
					camControls2.lookSpeed = 0.15;//note: it also doesn't work properly
					camControls.movementSpeed = 2.0;//note: it also doesn't work properly
					camControls.lookSpeed = 0.15;//note: it also doesn't work properly
					}
				if ( keyboard.pressed("ctrl") ){//almost positive this is original code
					camControls2.movementSpeed = 0.25;//note: it also doesn't work properly
					camControls2.lookSpeed = 0.05;//note: it also doesn't work properly
					camControls.movementSpeed = 0.25;//note: it also doesn't work properly
					camControls.lookSpeed = 0.05;//note: it also doesn't work properly
					}
				if ( keyboard.pressed("E") ){//almost positive this is original code
					camera2.rotateY(Math.PI/-1);//original code
					camera2.rotateZ((Math.PI)/-1);//original code
					}//this line is probably safe :P
				if ( keyboard.pressed("J") ) {guivalues.getLostBoth();}
				if ( keyboard.pressed("K") ) {guivalues.getLostComp();}
				if ( keyboard.pressed("L") ) {guivalues.getLostPract();}
				
				if ( keyboard.pressed("R") ) {guivalues.lookAtRedBuoy();}
				if ( keyboard.pressed("Y") ) {guivalues.lookAtYellowBuoy();}
				if ( keyboard.pressed("G") ) {guivalues.lookAtGreenBuoy();}


				if ( keyboard.pressed("P") ) {lightFix.lightDepthFix();}
				if ( keyboard.pressed("V") ) {
					//guivalues.lightDepthFix();
					guivalues.randomVis();
				}
				lightFix.lightDepthFix();
				//if ( true ) {
					//guivalues.lightDepthFix();

				//}
				if ( camera2.position.y > -0.80) { //cheap hack to bypass the fog entangling impact of using a single .obj/.mtl file above and below water
						scene2.fog.density = 0.0; 
						scene.fog.density = 0.0;
						guivalues.normalLight();
					}
				if ( camera2.position.y < -0.81 && camera2.position.y > -.9) { //cheap hack to bypass the fog entangling impact of using a single .obj/.mtl file above and below water
						scene2.fog.density = 0.1875; 
						scene.fog.density = 0.1875;
					}
					
				if ( camera2.position.y < -5.5 ) { //cheap hack to bound behavior
						camera2.position.y = -5.5; 
						camera.position.y = -5.5; 
					}
				if ( camera2.position.y > 5.5 ) { //cheap hack to bound behavior
						camera2.position.y = 5.5; 
						camera.position.y = 5.5; 
					}

				
				renderer.render( scene, camera ); //render everything else
				renderer2.render( scene2, camera2 ); //render everything else
			}
			//source: MIT License OR "This code no longer appears to contain anything that belongs to josdirksen?"

		</script>
	</body>
</html>
